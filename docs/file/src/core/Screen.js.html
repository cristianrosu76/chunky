<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/core/Screen.js | react-chunky</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="The Chunky Universal Framework"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="react-chunky"><meta property="twitter:description" content="The Chunky Universal Framework"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/react-chunky/react-chunky"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#config">config</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DEFAULT_AUTH_TYPE">API_DEFAULT_AUTH_TYPE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DEFAULT_CACHE">API_DEFAULT_CACHE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DEFAULT_ENDPOINT">API_DEFAULT_ENDPOINT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DEFAULT_METHOD">API_DEFAULT_METHOD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DEFAULT_SECURE">API_DEFAULT_SECURE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DEFAULT_SERVER_URL">API_DEFAULT_SERVER_URL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DEFAULT_TIMEOUT">API_DEFAULT_TIMEOUT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_DELETE_METHOD">API_DELETE_METHOD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_FORM_CONTENT_TYPE">API_FORM_CONTENT_TYPE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_GET_METHOD">API_GET_METHOD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_JSON_CONTENT_TYPE">API_JSON_CONTENT_TYPE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_POST_METHOD">API_POST_METHOD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_PUT_METHOD">API_PUT_METHOD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_SECURITY_TYPE_BEARER">API_SECURITY_TYPE_BEARER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_SECURITY_TYPE_JWT">API_SECURITY_TYPE_JWT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTH_CACHE_KEY">AUTH_CACHE_KEY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CONTEXT_CACHE_KEY">CONTEXT_CACHE_KEY</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core">core</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/DataProvider.js~DataProvider.html">DataProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Error.js~ChunkyError.html">ChunkyError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Generator.js~Generator.html">Generator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/Screen.js~Screen.html">Screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Container">Container</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-actions">data/actions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-asyncAction">asyncAction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-error">error</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ok">ok</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-start">start</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timestamp">timestamp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-type">type</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-cache">data/cache</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cacheAuth">cacheAuth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cacheContext">cacheContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-clearAuth">clearAuth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-clearContext">clearContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-retrieveAuth">retrieveAuth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-retrieveContext">retrieveContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cacheItem">cacheItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-clearCachedItem">clearCachedItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-retrieveCachedItem">retrieveCachedItem</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-model">data/model</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/model/Token.js~Token.html">Token</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/model/User.js~User.html">User</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-providers">data/providers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/providers/cache.js~CacheDataProvider.html">CacheDataProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/providers/firebase.js~FirebaseDataProvider.html">FirebaseDataProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/providers/local.js~LocalDataProvider.html">LocalDataProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/data/providers/rest.js~RestDataProvider.html">RestDataProvider</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-reducers">data/reducers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-asyncReducer">asyncReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-reducers">reducers</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-selectors">data/selectors</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get">get</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getAction">getAction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getData">getData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getError">getError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTimestamp">getTimestamp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-has">has</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hasData">hasData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hasError">hasError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isDone">isDone</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isInProgress">isInProgress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getAuthToken">getAuthToken</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getAuthTokenError">getAuthTokenError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getAuthTokenTimestamp">getAuthTokenTimestamp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hasAuthToken">hasAuthToken</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hasAuthTokenError">hasAuthTokenError</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#data-store">data/store</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-store">store</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#errors">errors</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-TIMEOUT_ERROR">TIMEOUT_ERROR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-COULD_NOT_CACHE_ITEM">COULD_NOT_CACHE_ITEM</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-COULD_NOT_CLEAR_CACHED_ITEM">COULD_NOT_CLEAR_CACHED_ITEM</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-COULD_NOT_RETRIEVE_CACHED_ITEM">COULD_NOT_RETRIEVE_CACHED_ITEM</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UNABLE_TO_LOAD_APP">UNABLE_TO_LOAD_APP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UNABLE_TO_LOAD_CHUNKS">UNABLE_TO_LOAD_CHUNKS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UNDEFINED_OPERATION">UNDEFINED_OPERATION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-WARNING_EMPTY_RESPONSE">WARNING_EMPTY_RESPONSE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-WARNING_INVALID_RESPONSE">WARNING_INVALID_RESPONSE</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#styles">styles</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-styleColor">styleColor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MaterialColors">MaterialColors</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/core/Screen.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { Component } from &apos;react&apos;
import URL from &apos;url-parse&apos;
import { AllHtmlEntities } from &apos;html-entities&apos;
// import { diff } from &apos;deep-diff&apos;

export default class Screen extends Component {
  constructor (props) {
    super(props)

    this.state = { lastTransitionTimestamp: &apos;&apos;, visible: true, progress: false }
    this._entities = new AllHtmlEntities()
    this._containerId = props[&apos;@&apos;] ? props[&apos;@&apos;].id : undefined
  }

  get entities () {
    return this._entities
  }

  get containerId () {
    return this._containerId
  }

  get isContainer () {
    return (this.containerId !== undefined)
  }

  componentDidMount () {
    // Automatically attempt to retrieve the main data, if possible and if desired
    if (this.props.startOperationsOnMount &amp;&amp; this.props.startOperation) {
      this.props.startOperation()
    }
  }

  updateProgress (progressTitle) {
    this.setState({ progressTitle })
  }

  componentWillMount () {
    for (const transitionName in this.props.transitions) {
      // Inject all transitions into this screen
      this.injectTransition(this.props.transitions[transitionName])
    }
  }

  componentWillUnmount () {
  }

  injectTransition (transition) {
    this.transitions = this.transitions || {}
    this.transitions[transition.name] = (data) =&gt; {
      this.transition(transition, data)
    }
  }

  // injectBasicAuth (url) {
  //   if (!this.props.basicAuth) {
  //     return url
  //   }
  //
  //   const urlRef = new URL(url)
  //   const protocol = urlRef.protocol
  //   const link = url.substring(protocol.length + 2)
  //   return `${protocol}//${this.props.basicAuth.username}:${this.props.basicAuth.password}@${link}`
  // }

  transition (transition, data) {
    const timeSinceLastTransition = Date.now() - this.state.lastTransitionTimestamp
    if (this.state.lastTransitionTimestamp &amp;&amp; timeSinceLastTransition &lt; 500) {
      // Ignore transition
      return
    }

    // Turn off the progress
    if (this.state.progress) {
      this.setState({ progress: false })
    }

    // Timestamp this transition
    this.setState({ lastTransitionTimestamp: Date.now(), visible: false })
    this[`${transition.type.toLowerCase()}Transition`] &amp;&amp; this[`${transition.type.toLowerCase()}Transition`](transition, Object.assign({}, data, { transition }))
  }

  _operationDidFinish (name, data, operation, handler) {
    if (typeof operation[handler] !== &apos;string&apos;) {
      // We only handle simple handlers at the moment
      return
    }

    // Let&apos;s see what we have as a handler
    const parts = operation[handler].split(&apos;:&apos;)

    if (parts &amp;&amp; parts.length === 2) {
      // Perform the transition
      const transition = `${parts[1].charAt(0).toUpperCase()}${parts[1].substring(1)}`
      this.transitions[`show${transition}`] &amp;&amp; this.transitions[`show${transition}`]({ [operation.flavor]: data })
      return
    }

    if (parts &amp;&amp; parts.length === 1) {
      // Execute the specified operation
      this[operation[handler]] ? this[operation[handler]](data) : (this.props[operation[handler]] &amp;&amp; this.props[operation[handler]](data))
    }
  }

  isForeignOperation (operation) {
    const foreign = (this.containerId !== operation.routeId)
    return foreign
  }

  operationDidFinish (name, data, error, operation) {
    if (operation &amp;&amp; operation.onError &amp;&amp; error &amp;&amp; error[operation.flavor]) {
      return this._operationDidFinish(name, error[operation.flavor], operation, &apos;onError&apos;)
    }

    if (operation &amp;&amp; operation.onSuccess &amp;&amp; (!error || !error[operation.flavor])) {
      // The operation response is successful
      return this._operationDidFinish(name, data ? data[operation.flavor] || {} : {}, operation, &apos;onSuccess&apos;)
    }
  }

  shouldComponentUpdate (nextProps, nextState) {
    return true
  }

  componentWillReceiveProps (nextProps) {
    const operation = (nextProps.action ? this.props[`@${nextProps.action()}`] : undefined)

    if (operation &amp;&amp; !this.isForeignOperation(operation) &amp;&amp; this.props.isDataLoading() &amp;&amp; nextProps.isDataLoaded()) {
      // Looks like an operation just finished, so let&apos;s trigger the callback
      this.operationDidFinish(nextProps.action(), nextProps.data(), nextProps.dataError(), operation)
    }
  }

  renderDataError ({ main }) {
    throw new Error(&apos;Chunky says: implement renderDataError in your route.&apos;)
  }

  renderDataLoading () {
    throw new Error(&apos;Chunky says: implement renderDataLoading in your route.&apos;)
  }

  renderDataDefaults () {
    throw new Error(&apos;Chunky says: implement renderDataDefaults in your route.&apos;)
  }

  renderData () {
    throw new Error(&apos;Chunky says: implement renderData in your route.&apos;)
  }

  renderDataChecks () {

  }

  render () {
    if (this.state.progress &amp;&amp; this.renderProgress) {
      return this.renderProgress()
    }

    if (this.props.isDataLoading &amp;&amp; this.props.isDataLoading() &amp;&amp; this.renderDataLoading) {
      // We&apos;re loading the data still
      return this.renderDataLoading()
    }

    if (this.props.hasDataError &amp;&amp; this.props.hasDataError() &amp;&amp; this.renderDataError) {
      // Looks like there&apos;s an error that we need to handle
      return this.renderDataError(this.props.dataError())
    }

    if (this.props.hasData &amp;&amp; !this.props.hasData() &amp;&amp; this.renderDataDefaults) {
      // This screen does not have any data to render
      return this.renderDataDefaults()
    }

    if (this.props.hasData &amp;&amp; this.props.hasData() &amp;&amp; this.renderData) {
      return this.renderData(this.props.data())
    }
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
